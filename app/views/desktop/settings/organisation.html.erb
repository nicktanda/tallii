<% flash.each do |type, msg| %>
  <div class="text-red-500 border-red-500 w-full p-2 border-2 rounded-lg">
    <%= msg %>
  </div>
<% end %>
<div class="space-y-12 h-[85vh] overflow-y-scroll p-4">
  <div class="flex space-x-4 items-center">
    <div class="font-bold text-2xl">Administration</div>
    <%= link_to desktop_organisation_settings_path do %>
      <div class="bg-white p-2 rounded-lg">Company Profile</div>
    <% end %>
    <%= link_to desktop_staff_settings_path do %>
      <div class="p-2 rounded-lg">Staff Management</div>
    <% end %>
    <%= link_to desktop_user_settings_path do %>
      <div class="p-2 rounded-lg">User Profile</div>
    <% end %>
  </div>
  <%= form_for current_organisation, url: update_desktop_organisation_settings_path, method: :patch do |f| %>
    <div class="space-y-4">
      <div class="space-y-8 w-full bg-white rounded-lg p-4">
        <div class="flex space-x-4">
          <div class="w-1/3">
            <div class="text-blue-900 font-bold">Company Information</div>
            <div class="text-sm font-thin">Your company details</div>
          </div>
          <div class="w-full space-y-4">
            <div>
              <div class="flex">
                <%= f.label :name %>
                <div class="text-red-500">*</div>
              </div>
              <%= f.text_field :name, required: true, class: "border w-full rounded-lg p-2" %>
            </div>
            <div>
              <div class="flex">
                <%= f.label :email %>
                <div class="text-red-500">*</div>
              </div>
              <%= f.email_field :email, class: "border w-full rounded-lg p-2" %>
            </div>
            <div>
              <%= f.label :phone %>
              <%= phone_with_country_code_field(f, :phone, class: "border w-full rounded-lg p-2") %>
            </div>
          </div>
        </div>
        <div class="flex space-x-4">
          <div class="w-1/3">
            <div class="text-blue-900 font-bold">Company Address</div>
            <div class="text-sm font-thin">Where is your business located</div>
          </div>
          <div class="w-full space-y-4">
            <div>
              <%= f.label :address %>
              <%= f.text_field :address, class: "border w-full rounded-lg p-2" %>
            </div>
            <div>
              <%= f.label :city %>
              <%= f.text_field :city, class: "border w-full rounded-lg p-2" %>
            </div>
            <div>
              <%= f.label :postcode %>
              <%= f.text_field :postcode, class: "border w-full rounded-lg p-2" %>
            </div>
          </div>
        </div>
        <div class="flex space-x-4">
          <div class="w-1/3">
            <div class="text-blue-900 font-bold">Opening Hours</div>
            <div class="text-sm font-thin">Set your business hours for each day</div>
          </div>
          <div class="w-full space-y-3">
            <% opening_hours = current_organisation.opening_hours || {} %>
            <% ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'].each do |day| %>
              <div class="flex items-center space-x-4">
                <div class="w-24 font-semibold"><%= day %></div>
                <div class="flex items-center space-x-2">
                  <label class="flex items-center">
                    <input type="checkbox"
                           name="organisation[opening_hours][<%= day %>][closed]"
                           value="true"
                           <%= 'checked' if opening_hours.dig(day, 'closed') %>
                           class="mr-2"
                           onchange="toggleDayInputs(this, '<%= day %>')">
                    <span>Closed</span>
                  </label>
                  <div class="flex items-center space-x-2" id="<%= day %>-inputs">
                    <%= text_field_tag "organisation[opening_hours][#{day}][open]",
                                       opening_hours.dig(day, 'open'),
                                       type: 'time',
                                       disabled: opening_hours.dig(day, 'closed'),
                                       class: "border rounded-lg p-2" %>
                    <span>to</span>
                    <%= text_field_tag "organisation[opening_hours][#{day}][close]",
                                       opening_hours.dig(day, 'close'),
                                       type: 'time',
                                       disabled: opening_hours.dig(day, 'closed'),
                                       class: "border rounded-lg p-2" %>
                  </div>
                </div>
              </div>
            <% end %>
          </div>
        </div>
        <div class="flex space-x-4">
          <div class="w-1/3">
            <div class="text-blue-900 font-bold">Booking Settings</div>
            <div class="text-sm font-thin">Configure your booking limits</div>
          </div>
          <div class="w-full space-y-4">
            <div>
              <div class="flex">
                <%= f.label :maximum_daily_daycare_visits, "Maximum Daily Daycare Visits" %>
                <div class="text-red-500">*</div>
              </div>
              <%= f.number_field :maximum_daily_daycare_visits, required: true, step: 0, value: current_organisation.maximum_daily_daycare_visits, class: "bg-white text-black w-full rounded-lg p-4" %>
            </div>
            <div>
              <div class="flex">
                <%= f.label :maximum_weekly_daycare_visits, "Maximum Weekly Daycare Visits" %>
                <div class="text-red-500">*</div>
              </div>
              <%= f.number_field :maximum_weekly_daycare_visits, required: true, step: 0, value: current_organisation.maximum_weekly_daycare_visits, class: "bg-white text-black w-full rounded-lg p-4" %>
            </div>
            <div>
              <div class="flex">
                <%= f.label :maximum_daily_grooms, "Maximum Daily Grooms" %>
                <div class="text-red-500">*</div>
              </div>
              <%= f.number_field :maximum_daily_grooms, required: true, step: 0, value: current_organisation.maximum_daily_grooms, class: "bg-white text-black w-full rounded-lg p-4" %>
            </div>
            <div>
              <div class="flex">
                <%= f.label :maximum_weekly_grooms, "Maximum Weekly Grooms" %>
                <div class="text-red-500">*</div>
              </div>
              <%= f.number_field :maximum_weekly_grooms, required: true, step: 0, value: current_organisation.maximum_weekly_grooms, class: "bg-white text-black w-full rounded-lg p-4" %>
            </div>
          </div>
        </div>
        <div class="flex space-x-4">
          <div class="w-1/3">
            <div class="text-blue-900 font-bold">Security</div>
            <div class="text-sm font-thin">Configure who can access your part of Talii</div>
          </div>
          <div class="w-full space-y-4">
            <div>
              <%= f.label :access_code, "Talii Customer Access Code" %>
              <%= f.text_field :access_code, readonly: true, value: current_organisation.access_code, class: "bg-white text-black w-full rounded-lg p-4" %>
              <div class="font-thin text-sm">Give this to customers signing up to your business if you aren't creating them through Talii</div>
            </div>
          </div>
        </div>
      </div>
      <div class="font-thin px-8">+ Last Save: <%= current_organisation.updated_at.strftime('%d %b %Y') %></div>
      <div class="flex justify-center">
        <button type="submit" class="bg-blue-500 text-white font-bold p-2 px-8 rounded-lg flex items-center justify-center">
          Update Details
        </button>
      </div>
    </div>
  <% end %>
</div>
<script>
  function toggleDayInputs(checkbox, day) {
    const inputs = document.getElementById(day + '-inputs').querySelectorAll('input[type="time"]');
    inputs.forEach(input => {
      input.disabled = checkbox.checked;
      if (checkbox.checked) {
        input.value = '';
      }
    });
  }

  // Initialize on page load
  document.addEventListener('DOMContentLoaded', function() {
    ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'].forEach(day => {
      const checkbox = document.querySelector(`input[name="organisation[opening_hours][${day}][closed]"]`);
      if (checkbox && checkbox.checked) {
        toggleDayInputs(checkbox, day);
      }
    });
  });
</script>