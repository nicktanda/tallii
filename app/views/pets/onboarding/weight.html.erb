<style>
  .weight-input-container {
    display: inline-flex;
    align-items: baseline;
    position: relative;
    width: 100%;
    justify-content: center;
  }
  
  .weight-input {
    width: auto;
    min-width: 150px;
    max-width: 400px;
    text-align: center;
    padding-right: 1.5rem !important;
  }
  
  .input-label {
    margin-left: 1rem;
    color: #FEF08A;
    font-size: 24px;
    align-self: center;
  }

  /* Slider Track with Text */
  .slider-container {
    position: absolute; /* Change position to absolute */
    bottom: 20px; /* Position from the bottom of the viewport */
    left: 50%; /* Center horizontally */
    transform: translateX(-50%); /* Centering correction */
    width: 100%; /* Full width */
    max-width: 500px; /* Max width */
  }
</style>
<div class="m-2">
  <%= form_with url: update_pet_weight_onboarding_path(@pet), id: "petWeightForm" do |f| %>
    <div class="text-center mb-8">
      <div class="text-yellow-200 text-4xl mt-12">Weight</div>
      <div class="text-gray-400 text-2xl mt-4">How much does <%= @pet.name %> weigh?</div>
    </div>
    <div class="w-full mb-4 mt-24 px-32">
      <div class="weight-input-container">
        <%= f.number_field :weight, required: true, step: "0.01", 
          class: "weight-input bg-black text-white border-x-0 border-t-0 border-yellow-200 text-5xl font-bold pt-6 pl-4 placeholder-transparent", 
          id: "weight", placeholder: " " %>
        <span class="input-label text-yellow-200">lbs</span>
      </div>
    </div>
    <div class="p-8">
      <%= f.submit "Next", class: "w-full bg-blue-800 p-4 rounded-lg text-white" %>
    </div>
    <div class="slider-container mt-32 px-8">
      <div class="mt-12 flex space-x-1 mx-12">
        <div class="w-full h-1 bg-yellow-200"></div>
        <div class="w-full h-1 bg-yellow-200"></div>
        <div class="w-full h-1 bg-yellow-200"></div>
        <div class="w-full h-1 bg-yellow-200"></div>
        <div class="w-full h-1 bg-yellow-200"></div>
        <div class="w-full h-1 bg-gray-400"></div>
        <div class="w-full h-1 bg-gray-400"></div>
      </div>
    </div>
  <% end %>
</div>
<script>
  var slider = document.getElementById("myRange");
  var form = document.getElementById("petWeightForm");
  var weightInput = document.getElementById("weight");

  // Create a hidden span to measure text width
  var measureSpan = document.createElement('span');
  measureSpan.style.visibility = 'hidden';
  measureSpan.style.position = 'absolute';
  measureSpan.style.fontSize = window.getComputedStyle(weightInput).fontSize;
  measureSpan.style.fontFamily = window.getComputedStyle(weightInput).fontFamily;
  measureSpan.style.fontWeight = window.getComputedStyle(weightInput).fontWeight;
  measureSpan.style.letterSpacing = window.getComputedStyle(weightInput).letterSpacing;
  measureSpan.style.whiteSpace = 'pre';
  document.body.appendChild(measureSpan);

  // Function to adjust input width based on actual text width
  function adjustInputWidth() {
    var value = weightInput.value || "";
    // Use placeholder width if empty
    measureSpan.textContent = value || "000";
    var textWidth = measureSpan.offsetWidth;
    // Add moderate padding for a reasonably wider input field
    weightInput.style.width = (textWidth + 100) + "px";
  }

  // Adjust width on input
  weightInput.addEventListener('input', adjustInputWidth);
  
  // Adjust width on page load if there's a value
  adjustInputWidth();

  slider.oninput = function() {
    if (this.value == this.max) {
      // Submit the form when the slider reaches the max value
      Turbo.navigator.submitForm(document.getElementById("petWeightForm"));
    }
  }
</script>